

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="懂一点点">
  <meta name="author" content="Gotcha">
  <meta name="keywords" content="">
  
  <title>SpringBoot中RestTemplate使用 - Gotcha的笔记总结</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"cd190160b5401a029cee361d013e32a1","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"U8yaiFQ2fUef4ujWTig83mSL-gzGzoHsz","app_key":"akCMytdeJqrMuKP84F4oblqz","server_url":"https://u8yaifq2.lc-cn-n1-shared.com"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Gotcha的笔记总结</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/background/01.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="SpringBoot中RestTemplate使用">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-09-08 00:00" pubdate>
        2022年9月8日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.7k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      100
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SpringBoot中RestTemplate使用</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2022年9月8日 凌晨
                
              </p>
            
            <div class="markdown-body">
              <h1 id="一、RestTemplate概述"><a href="#一、RestTemplate概述" class="headerlink" title="一、RestTemplate概述"></a>一、RestTemplate概述</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><p>在项目中，当需要远程调用一个 HTTP 接口时，经常会用到 RestTemplate 这个类。这个类是 Spring 框架提供的一个工具类。Spring 官网对它的介绍如下：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.9.RELEASE/spring-framework-reference/integration.html#rest-resttemplate">RestTemplate</a>: The original Spring REST client with a synchronous, template method API.</p>
</blockquote>
<p>从上面的介绍中可以知道：RestTemplate是一个同步的 Rest API 客户端。</p>
<blockquote>
<p>官网中明确说明，从Spring5.0开始，非阻塞、反应式WebClient为RestTemplate提供了一个现代化的替代方案，它有效支持同步、异步和流场景。因此RestTemplate将在未来版本中被弃用，今后不会添加主要的新功能。</p>
</blockquote>
<h2 id="1-2-主要方法"><a href="#1-2-主要方法" class="headerlink" title="1.2 主要方法"></a>1.2 主要方法</h2><table>
<thead>
<tr>
<th align="left">Method group</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>getForObject</code></td>
<td align="left">Retrieves a representation via GET.</td>
</tr>
<tr>
<td align="left"><code>getForEntity</code></td>
<td align="left">Retrieves a <code>ResponseEntity</code> (that is, status, headers, and body) by using GET.</td>
</tr>
<tr>
<td align="left"><code>headForHeaders</code></td>
<td align="left">Retrieves all headers for a resource by using HEAD.</td>
</tr>
<tr>
<td align="left"><code>postForLocation</code></td>
<td align="left">Creates a new resource by using POST and returns the <code>Location</code> header from the response.</td>
</tr>
<tr>
<td align="left"><code>postForObject</code></td>
<td align="left">Creates a new resource by using POST and returns the representation from the response.</td>
</tr>
<tr>
<td align="left"><code>postForEntity</code></td>
<td align="left">Creates a new resource by using POST and returns the representation from the response.</td>
</tr>
<tr>
<td align="left"><code>put</code></td>
<td align="left">Creates or updates a resource by using PUT.</td>
</tr>
<tr>
<td align="left"><code>patchForObject</code></td>
<td align="left">Updates a resource by using PATCH and returns the representation from the response. Note that the JDK <code>HttpURLConnection</code> does not support the <code>PATCH</code>, but Apache HttpComponents and others do.</td>
</tr>
<tr>
<td align="left"><code>delete</code></td>
<td align="left">Deletes the resources at the specified URI by using DELETE.</td>
</tr>
<tr>
<td align="left"><code>optionsForAllow</code></td>
<td align="left">Retrieves allowed HTTP methods for a resource by using ALLOW.</td>
</tr>
<tr>
<td align="left"><code>exchange</code></td>
<td align="left">More generalized (and less opinionated) version of the preceding methods that provides extra flexibility when needed. It accepts a <code>RequestEntity</code> (including HTTP method, URL, headers, and body as input) and returns a <code>ResponseEntity</code>.These methods allow the use of <code>ParameterizedTypeReference</code> instead of <code>Class</code> to specify a response type with generics.</td>
</tr>
<tr>
<td align="left"><code>execute</code></td>
<td align="left">The most generalized way to perform a request, with full control over request preparation and response extraction through callback interfaces.</td>
</tr>
</tbody></table>
<p>上面的方法大致可以分为三组：</p>
<ul>
<li>getForObject — optionsForAllow 分为一组，这类方法是常规的 Rest API（GET、POST、DELETE 等）方法调用；</li>
<li>exchange：接收一个 <code>RequestEntity</code> 参数，可以自己设置 HTTP method，URL，headers 和 body，返回 ResponseEntity；</li>
<li>execute：通过 callback 接口，可以对请求和返回做更加全面的自定义控制。</li>
</ul>
<h1 id="二、在SpringBoot中创建RestTemplate"><a href="#二、在SpringBoot中创建RestTemplate" class="headerlink" title="二、在SpringBoot中创建RestTemplate"></a>二、在SpringBoot中创建RestTemplate</h1><p>RestTemplate默认使用HttpUrlConnection，可以通过构造方法替换底层引擎。默认配置如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">(ClientHttpRequestFactory factory)</span> </span>&#123;<br>    RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate(factory);<br>    <span class="hljs-keyword">return</span> restTemplate;<br>&#125;<br><br><br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ClientHttpRequestFactory <span class="hljs-title">simpleClientHttpRequestFactory</span><span class="hljs-params">()</span> </span>&#123;<br>    SimpleClientHttpRequestFactory factory = <span class="hljs-keyword">new</span> SimpleClientHttpRequestFactory();<br>    factory.setReadTimeout(<span class="hljs-number">5000</span>);<br>    factory.setConnectTimeout(<span class="hljs-number">15000</span>);<br>    <span class="hljs-comment">// 设置代理</span><br>    <span class="hljs-comment">//factory.setProxy(null);</span><br>    <span class="hljs-keyword">return</span> factory;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>创建 RestTemplate 时需要一个 ClientHttpRequestFactory，通过这个请求工厂，可以统一设置请求的超时时间，设置代理以及一些其他细节。通过上面代码配置后，直接在代码中注入 RestTemplate 就可以使用了。</p>
<p>有时候还需要通过 ClientHttpRequestFactory 配置最大链接数，忽略SSL证书等。</p>
<p>使用OKHttp引擎配置方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestTemplateConfig</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 声明 RestTemplate</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">httpRestTemplate</span><span class="hljs-params">()</span> </span>&#123;<br>        ClientHttpRequestFactory factory = httpRequestFactory();<br>        RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate(factory);<br>        <span class="hljs-comment">// 可以添加消息转换</span><br>        <span class="hljs-comment">//restTemplate.setMessageConverters(...);</span><br>        <span class="hljs-comment">// 可以增加拦截器</span><br>        <span class="hljs-comment">//restTemplate.setInterceptors(...);</span><br>        <span class="hljs-keyword">return</span> restTemplate;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ClientHttpRequestFactory <span class="hljs-title">httpRequestFactory</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory(okHttpConfigClient());<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> OkHttpClient <span class="hljs-title">okHttpConfigClient</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OkHttpClient().newBuilder()<br>                .connectionPool(pool())<br>                .connectTimeout(connectTimeout, TimeUnit.SECONDS)<br>                .readTimeout(readTimeout, TimeUnit.SECONDS)<br>                .writeTimeout(writeTimeout, TimeUnit.SECONDS)<br>                .hostnameVerifier((hostname, session) -&gt; <span class="hljs-keyword">true</span>)<br>                <span class="hljs-comment">// 设置代理</span><br><span class="hljs-comment">//              .proxy(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(&quot;127.0.0.1&quot;, 8888)))</span><br>                <span class="hljs-comment">// 拦截器</span><br><span class="hljs-comment">//                .addInterceptor()</span><br>                .build();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ConnectionPool <span class="hljs-title">pool</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConnectionPool(maxIdleConnections, keepAliveDuration, TimeUnit.SECONDS);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="三、Get方法"><a href="#三、Get方法" class="headerlink" title="三、Get方法"></a>三、Get方法</h1><p>RestTemplate有两个核心Get方法</p>
<ol>
<li><code>getForObject</code>方法可以获取对象。</li>
<li><code>getForEntity</code>方法可以获取对象和Http状态码、请求头等详细信息。</li>
</ol>
<h2 id="3-1-getForObject"><a href="#3-1-getForObject" class="headerlink" title="3.1 getForObject"></a>3.1 getForObject</h2><p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912103336143.png" srcset="/img/loading.gif" lazyload alt="image-20220912103336143"></p>
<ul>
<li>传递 GET 参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/restful/get/&#123;id&#125;&quot;)</span><br>	<span class="hljs-meta">@ResponseBody</span><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">restfulGetId</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> </span>&#123;<br>		String url = <span class="hljs-string">&quot;xxxxx&quot;</span>;<br>		Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;();<br>		params.put(<span class="hljs-string">&quot;tid&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>);<br>		params.put(<span class="hljs-string">&quot;cid&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>);<br>		params.put(<span class="hljs-string">&quot;id&quot;</span>, id);<br>		RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate();<br>		String result = restTemplate.getForObject(url, String.class, params);<br>		<span class="hljs-keyword">return</span> (result);<br>	&#125;	<br></code></pre></td></tr></table></figure>



<h2 id="3-2-getForEntity"><a href="#3-2-getForEntity" class="headerlink" title="3.2 getForEntity"></a>3.2 getForEntity</h2><p>在响应的数据中必然也有响应头，如果开发者需要获取响应头的话，那么就需要使用 getForEntity 来发送 HTTP 请求，此时返回的对象是一个 ResponseEntity 的实例，这个实例中包含了响应数据以及响应头，其中 getStatusCode 方法用来获取响应状态码， getBody 方法用来获取响应数据， getHeaders 方法用来获取响应头。</p>
<p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912103708687.png" srcset="/img/loading.gif" lazyload alt="image-20220912103708687"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@GetMapping(&quot;/getForEntity&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getForEntity</span><span class="hljs-params">()</span></span>&#123;<br>	Map&lt;String ,Long &gt;paramMap =<span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>	<span class="hljs-comment">//ResponseEntity包装返回结果</span><br>	ResponseEntity &lt;HashMap&gt; responseEntity =restTemplate.getForEntity(url,HashMap.class,paramMap);<br>	<span class="hljs-comment">//返回状态码包装类</span><br>	HttpStatus statusCode =responseEntity.getStatusCode();<br>	<span class="hljs-comment">//返回状态码</span><br>	<span class="hljs-keyword">int</span> StatusCodeValue=responseEntity.getStatusCodeValue();<br>	<span class="hljs-comment">//http返回头</span><br>	HttpHeaders headers=responseEntity.getHeaders();<br>	<span class="hljs-comment">//返回对应请求结果</span><br>	<span class="hljs-keyword">return</span> responseEntity.getBody();<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-3-区别"><a href="#3-3-区别" class="headerlink" title="3.3 区别"></a>3.3 区别</h2><p>getForObject 和 getForEntity 的差异主要体现在返回值的差异上， getForObject 的返回值就是服务提供者返回的数据，使用 getForObject 无法获取到响应头。</p>
<h1 id="四、Post方法"><a href="#四、Post方法" class="headerlink" title="四、Post方法"></a>四、Post方法</h1><p>RestTemplate有三个核心Post方法</p>
<ol>
<li><p><code>postForObject</code>方法可以获取对象。</p>
</li>
<li><p><code>postForEntity</code>方法可以获取对象和Http状态码、请求头等详细信息。</p>
</li>
<li><p><code>postForLocation</code>方法的返回值是一个 Uri 对象，可以实现跳转</p>
</li>
</ol>
<h2 id="4-1-postForObject"><a href="#4-1-postForObject" class="headerlink" title="4.1 postForObject"></a>4.1 postForObject</h2><p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912104646298.png" srcset="/img/loading.gif" lazyload alt="image-20220912104646298"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//基本类型传参</span><br><span class="hljs-meta">@GetMapping(&quot;/postForObject1&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> UserDT0 <span class="hljs-title">postForObject1</span> <span class="hljs-params">( )</span> </span>&#123;<br>	<span class="hljs-comment">//远程访问的Url UserDTO</span><br>	String url = <span class="hljs-string">&quot;http://localhost:8080/addUser1&quot;</span>;<br>	<span class="hljs-comment">// Post方法必须使用MultiValueMap传参。//使用UserDTO传参也可以</span><br>	<br>	MultiValueMap&lt;String，0bject&gt; paramMap = <span class="hljs-keyword">new</span> LinkedMultiValueMap&lt;&gt;();<br>	paramMap.add (<span class="hljs-string">&quot;userId&quot;</span>, <span class="hljs-number">1008L</span>);<br>	paramMap.add (<span class="hljs-string">&quot;userName &quot;</span>，<span class="hljs-string">&quot;巧克力&quot;</span>);<br>	UserDT0 userDTO = restTemplate.postForObject(url,paramMap，UserDT0.class);<br>	<span class="hljs-keyword">return</span> userDTO;<br>&#125;<br><br><span class="hljs-comment">//实体类型传参</span><br><span class="hljs-meta">@GetMapping(&quot;/postForObject2&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> UserDT0 <span class="hljs-title">postForObject2</span><span class="hljs-params">( )</span> </span>&#123;<br>	<span class="hljs-comment">//申明一个请求头</span><br>	HttpHeaders headers = <span class="hljs-keyword">new</span> HttpHeaders();<br>	<span class="hljs-comment">//application/json</span><br>	headers.setContentType( MediaType .APPLICATION_JSON);<span class="hljs-comment">//远程访问的Url UserDTO</span><br>	string url = <span class="hljs-string">&quot;http://localhost:8080/addUser3&quot;</span>;<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">		此处使用MultiValueMap会报错</span><br><span class="hljs-comment">		MultiValueMap&lt;String，0bject&gt; paramMap = new LinkedMultiValueMap&lt;&gt;( );</span><br><span class="hljs-comment">		paramMap.add(&quot;userId&quot;,100OL) ;</span><br><span class="hljs-comment">		paramMap.add(&quot;userName&quot;,&quot;fencaibc&quot;);*/</span><br>	<span class="hljs-comment">//此处可以使用HashMap代替，但是会有警告</span><br>	<br>	UserDT0 userDTO = <span class="hljs-keyword">new</span> UserDTO( );<br>	userDTO.setUserId( <span class="hljs-number">1088L</span>);<br>	userDT0.setUserName(<span class="hljs-string">&quot;课程&quot;</span>);<br>	HttpEntity&lt;UserDTO&gt; entityParam <span class="hljs-keyword">new</span> HttpEntity&lt;UserDTO&gt;(userDTO，headers) ;<br>	UserDT0 result = restTemplate.postFor0bject(url, entityParam，UserDTO.class);<br>	<span class="hljs-keyword">return</span> result ;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-2-postForEntity"><a href="#4-2-postForEntity" class="headerlink" title="4.2 postForEntity"></a>4.2 postForEntity</h2><p>postForObject 和 postForEntity 基本一致，就是返回类型不同。</p>
<p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912105348867.png" srcset="/img/loading.gif" lazyload alt="image-20220912105348867"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> UserDT0 <span class="hljs-title">postForEntity1</span><span class="hljs-params">( )</span> </span>&#123;<br>	string url = <span class="hljs-string">&quot;http://localhost:8080/addUser1&quot;</span> ;<br>	MultiValueMap&lt;String，object&gt; paramMap = <span class="hljs-keyword">new</span> LinkedMultiValueMap&lt;&gt;( );<br>	paramMap.add(<span class="hljs-string">&quot;userId&quot;</span>, <span class="hljs-number">100</span>);<br>	paramMap.add(<span class="hljs-string">&quot;userName&quot;</span> ，<span class="hljs-string">&quot;课程&quot;</span>);<br>	ResponseEntity&lt;UserDT0&gt; userDTOResponseEntity =restTemplate.postForEntity(url,paramMap，UserDTO.class) ;<br>	HttpStatus statusCode = userDTOResponseEntity.getStatusCode( );<br>	<span class="hljs-keyword">int</span> statusCodeValue = userDTOResponseEntity.getStatusCodeValue( );<br>	HttpHeaders headers = userDTOResponseEntity. getHeaders( );<br>	<span class="hljs-keyword">return</span> userDTOResponseEntity. getBody( );<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-3-postForLocation"><a href="#4-3-postForLocation" class="headerlink" title="4.3 postForLocation"></a>4.3 postForLocation</h2><p>postForLocation 方法的返回值是一个 URI 对象，因为 POST 请求一般用来添加数据，有的时候需要将刚刚添加成功的数据的 URL 返回来，此时就可以使用这个方法。</p>
<p>一个常见的使用场景如用户注册功能，用户注册成功之后，可能就自动跳转到登录页面了，此时就可以使用该方法。例如在 provider 中提供一个用户注册接口，再提供一个用户登录接口，如下：</p>
<p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912105840829.png" srcset="/img/loading.gif" lazyload alt="image-20220912105840829"></p>
<p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912105908088.png" srcset="/img/loading.gif" lazyload alt="image-20220912105908088"></p>
<blockquote>
<p>postForLocation 方法返回的 URI 实际上是指响应头的 Location 字段，所以，provider 中 register 接口的响应头必须要有 Location 字段（即请求的接口实际上是一个重定向的接口），否则 postForLocation 方法的返回值为null</p>
</blockquote>
<h1 id="五、Put方法"><a href="#五、Put方法" class="headerlink" title="五、Put方法"></a>五、Put方法</h1><p>PUT 请求本身方法有三个，这三个重载的方法其参数其实和 POST 是一样的，可以用 key/value 的形式传参，也可以用 JSON 的形式传参，无论哪种方式，都是没有返回值的。</p>
<p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912110203308.png" srcset="/img/loading.gif" lazyload alt="image-20220912110203308"></p>
<h1 id="六、Delete方法"><a href="#六、Delete方法" class="headerlink" title="六、Delete方法"></a>六、Delete方法</h1><p>不同于 POST 和 PUT ，DELETE 请求的参数只能在地址栏传送，可以是直接放在路径中，也可以用 key/value 的形式传递，当然，这里也是没有返回值的。</p>
<p><img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912110349487.png" srcset="/img/loading.gif" lazyload alt="image-20220912110349487"></p>
<h1 id="七、Exchange方法"><a href="#七、Exchange方法" class="headerlink" title="七、Exchange方法"></a>七、Exchange方法</h1><p>exchange方法是RestTemplate 中的一个通用方法，这个方法需要在调用的时候去指定请求类型，即它既能做 GET 请求，也能做 POST 请求，也能做其它各种类型的请求。<img src="/2022/09/08/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E4%B8%ADRestTemplate%E4%BD%BF%E7%94%A8/image-20220912111400537.png" srcset="/img/loading.gif" lazyload alt="image-20220912111400537"></p>
<p>exchange的参数和前面的也都差不多，注意就是多了一个请求类型的参数，然后创建一个 HttpEntity 作为参数来传递。 HttpEntity 在创建时候需要传递两个参数，第一个是body（实际上就相当于 POST/PUT 请求中的第二个参数）。第二个参数是请求头，如果使用 exchange 来发送请求，可以直接定义请求头，而不需要使用拦截器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Exchange</span><span class="hljs-params">()</span> </span>&#123;<br>      HttpHeaders httpHeaders = <span class="hljs-keyword">new</span> HttpHeaders();<br>      String url = <span class="hljs-string">&quot;xxxxxxxx&quot;</span>;<br>      String requestDate = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;EEE, d MMM yyyy HH:mm:ss z&quot;</span>, Locale.ENGLISH).format(<span class="hljs-keyword">new</span> Date());<br>      httpHeaders.add(<span class="hljs-string">&quot;requestDate&quot;</span>, requestDate);<br>      httpHeaders.add(<span class="hljs-string">&quot;platform&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>);<br>     	MultiValueMap&lt;String，0bject&gt; paramMap = <span class="hljs-keyword">new</span> LinkedMultiValueMap&lt;&gt;();<br>paramMap.add(<span class="hljs-string">&quot;userId&quot;</span>,<span class="hljs-number">100</span>);<br>paramMap.add(<span class="hljs-string">&quot;userName &quot;</span>，<span class="hljs-string">&quot;exchange&quot;</span> );<br>      HttpEntity&lt;String&gt; httpEntity = <span class="hljs-keyword">new</span> HttpEntity&lt;&gt;(paramMap ,httpHeaders);<br>      ResponseEntity&lt;summaryDTO&gt; exchange = restTemplate.exchange(url, HttpMethod.POST, httpEntity, summaryDTO.class);<br>  &#125;<br></code></pre></td></tr></table></figure>



<h1 id="八、其他配置"><a href="#八、其他配置" class="headerlink" title="八、其他配置"></a>八、其他配置</h1><h2 id="8-1-拦截器配置"><a href="#8-1-拦截器配置" class="headerlink" title="8.1 拦截器配置"></a>8.1 拦截器配置</h2><p>RestTemplate 可以设置拦截器做一些统一处理。这个功能感觉和 Spring MVC 的拦截器类似。配置也很简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ClientHttpRequestInterceptor</span></span>&#123;<br> <br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> ClientHttpResponse <span class="hljs-title">intercept</span><span class="hljs-params">(HttpRequest request, <span class="hljs-keyword">byte</span>[] body, ClientHttpRequestExecution execution)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>	logger.info(<span class="hljs-string">&quot;enter interceptor...&quot;</span>);<br>	<span class="hljs-keyword">return</span> execution.execute(request,body);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">(ClientHttpRequestFactory factory)</span> </span>&#123;<br>    RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate(factory);<br>    MyInterceptor myInterceptor = <span class="hljs-keyword">new</span> MyInterceptor();<br>    List&lt;ClientHttpRequestInterceptor&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    list.add(myInterceptor);<br>    restTemplate.setInterceptors(list);<br>    <span class="hljs-keyword">return</span> restTemplate;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="8-2-异常处理器配置"><a href="#8-2-异常处理器配置" class="headerlink" title="8.2 异常处理器配置"></a>8.2 异常处理器配置</h2><p>ErrorHandler 用来对调用错误对统一处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyResponseErrorHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultResponseErrorHandler</span> </span>&#123;<br> <br>	<span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasError</span><span class="hljs-params">(ClientHttpResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.hasError(response);<br>	&#125;<br> <br>	<span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleError</span><span class="hljs-params">(ClientHttpResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>		HttpStatus statusCode = HttpStatus.resolve(response.getRawStatusCode());<br>		<span class="hljs-keyword">if</span> (statusCode == <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnknownHttpStatusCodeException(response.getRawStatusCode(), response.getStatusText(),response.getHeaders(), getResponseBody(response), getCharset(response));<br>		&#125;<br>        handleError(response, statusCode);<br>	&#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleError</span><span class="hljs-params">(ClientHttpResponse response, HttpStatus statusCode)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    	<span class="hljs-keyword">switch</span> (statusCode.series()) &#123;<br>            <span class="hljs-keyword">case</span> CLIENT_ERROR:<br>                    HttpClientErrorException exp1 = <span class="hljs-keyword">new</span> HttpClientErrorException(statusCode, response.getStatusText(), response.getHeaders(), getResponseBody(response), getCharset(response));<br>                    logger.error(<span class="hljs-string">&quot;客户端调用异常&quot;</span>,exp1);<br>                    <span class="hljs-keyword">throw</span>  exp1;<br>           <span class="hljs-keyword">case</span> SERVER_ERROR:<br>                    HttpServerErrorException exp2 = <span class="hljs-keyword">new</span> HttpServerErrorException(statusCode, response.getStatusText(),response.getHeaders(), getResponseBody(response), getCharset(response));<br>                    logger.error(<span class="hljs-string">&quot;服务端调用异常&quot;</span>,exp2);<br>                    <span class="hljs-keyword">throw</span> exp2;<br>          	<span class="hljs-keyword">default</span>:<br>                    UnknownHttpStatusCodeException exp3 = <span class="hljs-keyword">new</span> UnknownHttpStatusCodeException(statusCode.value(), response.getStatusText(),response.getHeaders(), getResponseBody(response), getCharset(response));<br>                    logger.error(<span class="hljs-string">&quot;网络调用未知异常&quot;</span>);<br>                    <span class="hljs-keyword">throw</span> exp3;<br>		&#125;<br>	&#125; <br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">(ClientHttpRequestFactory factory)</span> </span>&#123;<br>    RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate(factory);<br>    MyResponseErrorHandler errorHandler = <span class="hljs-keyword">new</span> MyResponseErrorHandler();<br>    restTemplate.setErrorHandler(errorHandler);<br>    List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters = restTemplate.getMessageConverters();<br>    <span class="hljs-comment">// 通过下面代码可以添加新的 HttpMessageConverter</span><br>    <span class="hljs-comment">//messageConverters.add(new );</span><br>    <span class="hljs-keyword">return</span> restTemplate;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="8-3-设置请求头"><a href="#8-3-设置请求头" class="headerlink" title="8.3 设置请求头"></a>8.3 设置请求头</h2><h3 id="8-3-1-为-post、put-请求设置请求头、请求体"><a href="#8-3-1-为-post、put-请求设置请求头、请求体" class="headerlink" title="8.3.1 为 post、put 请求设置请求头、请求体"></a>8.3.1 为 post、put 请求设置请求头、请求体</h3><p>如果是为 post、put 请求设置请求头、请求体，可以在调用方法时，利用第二个参数传入 HttpEntity 对象，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">HttpHeaders requestHeaders = <span class="hljs-keyword">new</span> HttpHeaders();<br>requestHeaders.set(<span class="hljs-string">&quot;MyRequestHeader&quot;</span>, <span class="hljs-string">&quot;MyValue&quot;</span>);<br>HttpEntity requestEntity = <span class="hljs-keyword">new</span> HttpEntity(requestHeaders);<br><br>Book book = restTemplate.postForObject(<span class="hljs-string">&quot;http://127.0.0.1:8080/getbook&quot;</span>, requestEntity, Book.class);<br></code></pre></td></tr></table></figure>

<p>同时设置请求头和请求体：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;post_with_body_and_header&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postWithBodyAndHeader</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody(required = false)</span> UserEntity requestBody)</span> </span>&#123;<br>    <span class="hljs-comment">// 1.请求头</span><br>    HttpHeaders httpHeaders = <span class="hljs-keyword">new</span> HttpHeaders();<br>    httpHeaders.add(<span class="hljs-string">&quot;headerName1&quot;</span>, <span class="hljs-string">&quot;headerValue1&quot;</span>);<br>    httpHeaders.add(<span class="hljs-string">&quot;headerName2&quot;</span>, <span class="hljs-string">&quot;headerValue2&quot;</span>);<br>    httpHeaders.add(<span class="hljs-string">&quot;headerName3&quot;</span>, <span class="hljs-string">&quot;headerValue3&quot;</span>);<br>    httpHeaders.add(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>); <span class="hljs-comment">// 传递请求体时必须设置</span><br><br>    <span class="hljs-comment">// 2.请求头 &amp; 请求体</span><br>    HttpEntity&lt;String&gt; fromEntity = <span class="hljs-keyword">new</span> HttpEntity&lt;&gt;(JSONUtil.toJsonStr(requestBody), httpHeaders);<br><br><br>    MessageBox responseBody = restTemplate.postForObject(INVOKE_URL + <span class="hljs-string">&quot;/test/receive&quot;</span>, fromEntity, MessageBox.class);<br>    log.info(<span class="hljs-string">&quot;响应体：&#123;&#125;&quot;</span>, JSONUtil.toJsonPrettyStr(responseBody));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="8-3-2-为其他请求设置请求头、请求体"><a href="#8-3-2-为其他请求设置请求头、请求体" class="headerlink" title="8.3.2 为其他请求设置请求头、请求体"></a>8.3.2 为其他请求设置请求头、请求体</h3><p>如果是其它HTTP方法调用要设置请求头，可以使用exchange()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">HttpHeaders requestHeaders = <span class="hljs-keyword">new</span> HttpHeaders();<br>requestHeaders.set(<span class="hljs-string">&quot;MyRequestHeader&quot;</span>, <span class="hljs-string">&quot;MyValue&quot;</span>);<br>HttpEntity requestEntity = <span class="hljs-keyword">new</span> HttpEntity(requestHeaders);<br><br>HttpEntity&lt;String&gt; response = template.exchange(<br>        <span class="hljs-string">&quot;http://example.com/hotels/&#123;hotel&#125;&quot;</span>,<br>        HttpMethod.GET, <br>        requestEntity, <br>        String.class, <br>        <span class="hljs-string">&quot;42&quot;</span><br>    );<br><br>String responseHeader = response.getHeaders().getFirst(<span class="hljs-string">&quot;MyResponseHeader&quot;</span>);<br>String body = response.getBody();<br></code></pre></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/%E6%A1%86%E6%9E%B6/">框架</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/%E6%A1%86%E6%9E%B6/Spring/">Spring</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/%E6%A1%86%E6%9E%B6/Spring/SpringBoot/">SpringBoot</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/">服务端接口调用</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/09/20/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/RabbitMQ%E5%85%A5%E9%97%A8/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">RabbitMQ入门</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/10/Java/%E6%A1%86%E6%9E%B6/SpringData/SpringDataJPA/SpringDataJPA%E5%BC%80%E5%8F%91%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/">
                        <span class="hidden-mobile">SpringDataJPA开发遇到的问题</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
    
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8.8.3/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>




  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?cd190160b5401a029cee361d013e32a1";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
